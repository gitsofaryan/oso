test_active_days_unified_counts_distinct_days:
  model: oso.contributor_active_days_unified_to_artifact_monthly
  vars:
    start: 2024-01-01
    end: 2024-01-31
  inputs:
    oso.int_events_daily__github_unified:
      rows:
        - bucket_day: 2024-01-01
          from_artifact_id: user_1
          to_artifact_id: repo_1
          event_source: GITHUB
          event_type: COMMIT_CODE
          amount: 3
        - bucket_day: 2024-01-01   # same day, different event type â€” still 1 distinct day
          from_artifact_id: user_1
          to_artifact_id: repo_1
          event_source: GITHUB
          event_type: ISSUE_OPENED
          amount: 1
        - bucket_day: 2024-01-05
          from_artifact_id: user_1
          to_artifact_id: repo_1
          event_source: GITHUB
          event_type: COMMIT_CODE
          amount: 2
        - bucket_day: 2024-01-10
          from_artifact_id: user_2
          to_artifact_id: repo_1
          event_source: GITHUB
          event_type: COMMIT_CODE
          amount: 1
  outputs:
    query:
      rows:
        - metrics_sample_date: 2024-01-01
          event_source: GITHUB
          to_artifact_id: repo_1
          from_artifact_id: user_1
          metric: contributor_active_days_unified_monthly
          amount: 2   # Jan 1 and Jan 5
        - metrics_sample_date: 2024-01-01
          event_source: GITHUB
          to_artifact_id: repo_1
          from_artifact_id: user_2
          metric: contributor_active_days_unified_monthly
          amount: 1   # Jan 10

test_active_days_unified_excludes_non_activity_events:
  model: oso.contributor_active_days_unified_to_artifact_monthly
  vars:
    start: 2024-01-01
    end: 2024-01-31
  inputs:
    oso.int_events_daily__github_unified:
      rows:
        - bucket_day: 2024-01-01
          from_artifact_id: user_1
          to_artifact_id: repo_1
          event_source: GITHUB
          event_type: STARRED   # not in activity_event_types
          amount: 1
  outputs:
    query:
      rows: []
